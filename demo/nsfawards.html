<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>NSF Awards, with ElementCode(s): 7364,7367,7495</title><meta charset="utf-8">
        <script type="text/javascript" src="../js/jquery-1.11.1.min.js"></script>
        <script type="text/javascript" src="../js/d3.v3.min.js" charset="utf-8"></script>
        <script type="text/javascript" src="../keshif.js" charset="utf-8"></script>
        <script type="text/javascript" src="../js/papaparse.min.js" charset="utf-8"></script>
        <link rel="stylesheet" href="../keshif.css"/ type="text/css">
        <link rel="stylesheet" href="../font-awesome/css/font-awesome.min.css">

        <script type="text/javascript" src="./js/demo.js" charset="utf-8"></script>
        <link rel="stylesheet" href="./css/style.css"/ type="text/css">

        <script type="text/javascript" src="./js/moment.min.js" charset="utf-8"></script>

        <script type="text/javascript">

$(document).ready(function(){
    var frmt = d3.format(".2s");
    
	browser = new kshf.Browser({
        domID: "#chart_div",
        itemName: "NSF Awards in 2014",//"Active NSF Awards",
        categoryTextWidth: 200,
        source: {
            url: 'http://www.nsf.gov/awardsearch/advancedSearchResult?ProgEleCode=7364,7367,7495&BooleanElement=ANY&BooleanRef=ANY&ActiveAwards=true',
            dirPath: './data/',
            fileType: 'csv',
            sheets: [ 
                {name:"awards", id:"AwardNumber", preview: 0},
                {name:"states", id:"id"},
                {name:"nsf_orgs", id:"code"},
            ],
        },
        loadedCb: function(){
            // If you downloaded using csv file, convert award amount field
            kshf.dt.awards.forEach(function(d){
                var v = d.data.AwardedAmountToDate;
                v=v.replace(/[^0-9]+/g,"");
                d.data.AwardedAmountToDate = parseInt(v)/100;
            });
            kshf.Util.cellToArray(kshf.dt.awards, ['Program(s)'], ", ", false);
        },
        facets: [
            {   title: "Program",
                catItemMap: function(d){
                    return d.data['Program(s)'];
                }
            },{ title: "Name",
                catItemMap: function(d){ return d.data.Organization; }
            },{ title: "AwardInstrument",
            },{ title: "Start Date", layout: 'bottom',
                catItemMap: function(d){
                    var dt = d.data.StartDate;
                    if(dt===""){ return null; }
                    var m = moment(dt,"MM/DD/YYYY");
                    return new Date(m);
                },
            },{ title: "NSFOrganization", 
                collapsed: true,
//                catTableName: 'nsf_orgs',
//                catLabelText: function(org){
//                    return org.data.name;
//                }
            },{ title: "NSFDirectorate", collapsed: true
            },{ title: "ProgramManager", collapsed: true
            },{ title: "Awarded Amount",
                catItemMap: function(d){ return d.data.AwardedAmountToDate; },
                intervalScale: 'log',
                unitName: "$",
/*            },{
                title: "PrincipalInvestigator",
                layout: 'right'*/
            },{ title: "-Institution-", layout: 'right',
                facets: [
                    {   title: "Name",
                        catItemMap: function(d){ return d.data.Organization; }
                    },{ title: "State", collapsed: true,
                        catItemMap: function(d){ return d.data.OrganizationState; }
                    }
/*                    },{
                        catTableName: 'states',
                        catLabelText: function(d){
                            return kshf.dt_id.states[d.data[1]].data.name;
                        }
//                    },{
//                        title: "OrganizationCity", collapsed: true
                    }*/
                ]
            }
        ],
        itemDisplay: {
            sortColWidth: 70,
            sortingOpts: [
                {   name: 'Amount', 
                    value: function(d){ 
                        return d.data.AwardedAmountToDate;// "$333,360.00"
                    },
                    label: function(d){
                        var v=d.data.AwardedAmountToDate;
                        if(v===undefined) return "-";
                        return frmt(v) + " $";
                    }
                },
//                { name: 'AwardNo', value: function(d){ return d.data.AwardNumber; } },
            ],
            textSearch: 'Title', // Off for now, content width is small.
            showRank: true,
            recordView: function(d){
                return " <a href='http://www.nsf.gov/awardsearch/showAward?AWD_ID="+d.data.AwardNumber
                    +"' style='font-size: 1em' target='_blank'>"+d.data.Title
                    +" <span class='fa fa-external-link'></span></a>";
            }
        }
    });
});
        </script>
<style> 
    #chart_div { height: 750px; width:1250px; }
    .content > a{
        color: black;
    }
    .content > a:hover{
        color: orangered;
    }
</style>
	</head>
    <body>
        <div class="contents"><div id="chart_div"></div></div>
    </body>
</html>