<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Hot posts on reddit</title><meta charset="utf-8">
        <script type="text/javascript" src="../js/jquery-1.11.1.min.js"></script>
        <script type="text/javascript" src="../js/d3.v3.min.js" charset="utf-8"></script>
        <script type="text/javascript" src="../keshif.js" charset="utf-8"></script>
        <link rel="stylesheet" href="../keshif.css"/ type="text/css">
        <link rel="stylesheet" href="../font-awesome/css/font-awesome.min.css">

        <script type="text/javascript" src="./js/demo.js" charset="utf-8"></script>
        <link rel="stylesheet" href="./css/style.css"/ type="text/css">

        <script type="text/javascript">
function loadData(browser){
    browser.primaryTableName = "Posts";
    kshf.dt.Posts = [];

    var subreddit = "hot";
    if(window.location.hash!==""){
        subreddit = window.location.hash.substring(1);
    }
    $.ajax( {
        url: "http://api.reddit.com/"+subreddit+".json?limit=100",
        dataType: "json",
        success: function(data){
            data.data.children.forEach(function(p){
                kshf.dt.Posts.push(new kshf.Item(p.data,'id'));
            });

            browser.items = kshf.dt.Posts;
            browser.itemsSelectedCt = kshf.dt.Posts.length;

            // finish loading....
            d3.select(".kshf.layout_infobox div.status_text span").text("Creating browser");
            d3.select(".kshf.layout_infobox div.status_text div").text("");
            window.setTimeout(function() { browser.loadCharts(); }, 50);
        }
    });
};

$(document).ready( function(){
	browser = new kshf.Browser({
        domID: "#chart_div",
        itemName: "Reddit Hot Posts",
        categoryTextWidth: 150,
        showDataSource: false,
        source: { callback: loadData },
        facets: [
            {   facetTitle: "subreddit"
            },{ facetTitle: "num_comments",
                catItemMap: function(post){ return post.data.num_comments; }
            },{ facetTitle: "score",
                catItemMap: function(post){ return post.data.score; }
            },{ facetTitle: "gilded",  
                type: "categorical"
            }
        ],
        itemDisplay: {
            sortColWidth: 60,
            sortingOpts: [ { name: 'score' } ],
            textSearch: "title",
            contentFunc: function(d){
                var str="";
                if(d.data.thumbnail!=="") { 
                    str+="<div style='float:right'><img src='"+d.data.thumbnail+"'/></div>";
                }
                str+=d.data.title;
                str+="<a class='fa fa-external-link' target='_blank' href='"+d.data.url+"' "+
                        "onclick='sendLog(CATID.ItemBased,ACTID_ITEM.FollowURL,{itemID:"+d.id()+"})'></a>";
                return str;
            }
        }
    });
});

</script>
    <style>
        #chart_div {
            width:800px;
            height:700px;
        }
    </style>
	</head>
    <body>
        <div class="contents"><div id="chart_div"></div></div>
    </body>
</html>